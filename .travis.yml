language: java

# To increase the memory size available during Travis build.
sudo: required

env:
  global:
    # Encrypted `CODACY_PROJECT_TOKEN` variable according to:
    # https://docs.travis-ci.com/user/environment-variables/#Encrypting-environment-variables
    - secure: wfdcbEHue3COzF21Uxo4DPd+dwutDRrKGrIDc6HajQIxGSqg5UV5XyaRRomCwzvE0dRGCePTBv0kmTCISkV7ou/32P19YhTyhrL/UayX4pG3uofTuBrpy8v0gvbQOE2+ajzLhHXrVnXjcFqEQPJjLATOp3EPIvC+EBW+/e+9fHD/4YdryRgS0BdN5+TbhHVf3j4zLntIyUGBXjVbzo3QOtgYK91u7RnpAVpN9SZZQtg/fyYpFniqnB5ULAnPEaumSny7HvZYSq9G4Q12do+NB5jfc7OCehzlqgIK1PsjWawfWwBFB3Q2l1Qj5h+gSssuIx3tZsj0MNI/MsEvMKxfNdVPCmQUxZUP7fk43eZUdf8LiABzCQQHGv3RkwwAYJlfeZm/ufvVA0Lu4OkPJJNLqjEQEUOjWVWG02qFOxBMBCw0LE9KuoB07zA6V+NVi3yCKuPkUgu+mWYqJ3buFGDRlgY1C34EHLCe+G4jFXu/NFuTMobCFnQP6kUPu63ZFpELes4EtfzfmiDVC2+eRjDAYtevS4uHnsTUsz7vABBUMHOqUcvXNXJGXNTYLkB5MSdE+MXjhDgkSGg9GHatAQx8Y0f7chisdNJZ8+cmLstOnZkTQLuLxpjwCzTED+i/5yrJ775dIbMetQYzeoTaQaXOes6hDR51w8Lfdqq4E332DrI=
    # Encrypted `GCS_SECRET` variable.
    - secure: nZE3BcvfH2bosJ0S8Sl2E+XsZPe13CFh2Vqcmk4vSxZ8b3bYEapWXKl2ZSBUa6MyLhpkCQ37vyqMX1RwSt0yDPc0QPSj/yxoN7c0TcAXusSvMdRlbf4u57rIeLCt90e3+JemkNzSPhNMXVQ8JovemvBdnEVk/9dCVEGUAHTaBEJ0NyPNutUHjcismY7MjdnrWSoliXAvUEjf4kMSlApmofLxiSCqYtxgK9U71hIoXSqityFsckNM/cqLUw6ABIKICL5zee37yPSbJ2sX7akZV7n3RvIWaqvPSi2uIORlGZP/2K63BbhbUcjVMwjMyE6xsDlC1lONc3c9H9CH6e17mcJqG6UwD9deYtcMaMETjoapKuoXl8SNv8kd8qznsubFXnLJ344g3Mk5yOVgHLdYjV61TSxFE98xCGJPnYF9tGyt7v8qrNQHG0pBRZvsaRg+j/TEqK5ZJaO3imRHwKUjKp4WrSbAcEDJFYZ0wCI+mAPELm12rDaMtzJHygkZztIljKyp7FsIuHQc5kHAmSxwpt6IsGSi8AR3OU77Fc0tmN9lCYxm95roDRR9KCWAnNjhTQ0hgHm836eF64HoOYjOupxY5OUZZYn4iO+lZC4WMNSHHKqQIV/6pwTZDge0r04e7nFBHr0j1jhErEcwQbejzBTwzmyDgx7+0KfzoGnMOGQ=

before_install:
  - chmod +x gradlew

script:
  - ./gradlew check --info`

  # Decrypt and unarchive Maven and Google Cloud Storage credentials.
  - openssl aes-256-cbc -K $encrypted_6fb721fde1c7_key -iv $encrypted_6fb721fde1c7_iv -in credentials.tar.enc -out credentials.tar -d
  - tar xvf credentials.tar

  - ./gradlew cleanGCS --info

  # The publishing script should be executed in `script` section in order to
  # fail the Travis build if execution of this script is failed.
  - chmod +x ./scripts/publish-artifacts.sh
  - ./scripts/publish-artifacts.sh

after_success:
  # See: https://github.com/codecov/example-java/blob/master/.travis.yml
  - bash <(curl -s https://codecov.io/bash)
  - chmod +x ./scripts/report-coverage.sh
  - ./scripts/report-coverage.sh

after_script:
  - chmod +x ./scripts/upload-artifacts.sh
  - ./scripts/upload-artifacts.sh
