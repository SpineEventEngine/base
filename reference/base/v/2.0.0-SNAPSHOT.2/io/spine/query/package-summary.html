<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>io.spine.query (base 2.0.0-SNAPSHOT.2 API)</title>
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="io.spine.query (base 2.0.0-SNAPSHOT.2 API)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../io/spine/protobuf/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../io/spine/reflect/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?io/spine/query/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<p>@CheckReturnValue
 @ParametersAreNonnullByDefault
</p>
<h1 title="Package" class="title">Package&nbsp;io.spine.query</h1>
<div class="docSummary">
<div class="block">This package defines the query DSL for the stored Protobuf messages.</div>
</div>
<p>See:&nbsp;<a href="#package.description">Description</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Interface Summary table, listing interfaces, and an explanation">
<caption><span>Interface Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Interface</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../io/spine/query/Column.html" title="interface in io.spine.query">Column</a>&lt;R,V&gt;</td>
<td class="colLast">
<div class="block">A column of a record residing in a storage.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../io/spine/query/Column.Getter.html" title="interface in io.spine.query">Column.Getter</a>&lt;R extends com.google.protobuf.Message,V&gt;</td>
<td class="colLast">
<div class="block">A method object serving to obtain the value of the column for some particular record of the
 matching type.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../io/spine/query/Either.html" title="interface in io.spine.query">Either</a>&lt;B extends <a href="../../../io/spine/query/QueryBuilder.html" title="interface in io.spine.query">QueryBuilder</a>&lt;?,?,?,?,?&gt;&gt;</td>
<td class="colLast">
<div class="block">A lambda serving to fill the current predicate <a href="../../../io/spine/query/QueryBuilder.html" title="interface in io.spine.query">query builders</a>
 with the parameters joined in <a href="../../../io/spine/query/LogicalOperator.html#OR">disjunction</a>.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../io/spine/query/Query.html" title="interface in io.spine.query">Query</a>&lt;I,R extends com.google.protobuf.Message&gt;</td>
<td class="colLast">
<div class="block">An query to fetch the records defined as Protobuf messages.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../io/spine/query/QueryBuilder.html" title="interface in io.spine.query">QueryBuilder</a>&lt;I,R extends com.google.protobuf.Message,P extends <a href="../../../io/spine/query/SubjectParameter.html" title="class in io.spine.query">SubjectParameter</a>&lt;R,?,?&gt;,B extends <a href="../../../io/spine/query/QueryBuilder.html" title="interface in io.spine.query">QueryBuilder</a>&lt;I,R,P,B,Q&gt;,Q extends <a href="../../../io/spine/query/Query.html" title="interface in io.spine.query">Query</a>&lt;I,R&gt;&gt;</td>
<td class="colLast">
<div class="block">A builder for instance of <a href="../../../io/spine/query/Query.html" title="interface in io.spine.query"><code>Query</code></a>.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../io/spine/query/ColumnName.html" title="class in io.spine.query">ColumnName</a></td>
<td class="colLast">
<div class="block">The name of the column of the record.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../io/spine/query/CustomColumn.html" title="class in io.spine.query">CustomColumn</a>&lt;S,V&gt;</td>
<td class="colLast">
<div class="block">A column storing the data which is not directly declared as a field in the <code>Message</code>
 of an <a href="../../../io/spine/base/EntityState.html" title="interface in io.spine.base"><code>EntityState</code></a> or a plain record.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../io/spine/query/CustomSubjectParameter.html" title="class in io.spine.query">CustomSubjectParameter</a>&lt;S,V&gt;</td>
<td class="colLast">
<div class="block">A query parameter, which defines a condition for a computed value stored along with
 the queried record.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../io/spine/query/EntityColumn.html" title="class in io.spine.query">EntityColumn</a>&lt;S extends <a href="../../../io/spine/base/EntityState.html" title="interface in io.spine.base">EntityState</a>&lt;?,?,?&gt;,V&gt;</td>
<td class="colLast">
<div class="block">A queryable column of an entity which can be passed to the query filters.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../io/spine/query/EntityCriterion.html" title="class in io.spine.query">EntityCriterion</a>&lt;S extends <a href="../../../io/spine/base/EntityState.html" title="interface in io.spine.base">EntityState</a>&lt;?,?,?&gt;,V,B extends <a href="../../../io/spine/query/EntityQueryBuilder.html" title="class in io.spine.query">EntityQueryBuilder</a>&lt;?,S,B,?&gt;&gt;</td>
<td class="colLast">
<div class="block">An expression which sets the value to compare for the <a href="../../../io/spine/query/EntityColumn.html" title="class in io.spine.query"><code>EntityColumn</code></a> in scope of
 a <a href="../../../io/spine/query/EntityQueryBuilder.html" title="class in io.spine.query"><code>EntityQueryBuilder</code></a> when building an <a href="../../../io/spine/query/EntityQuery.html" title="class in io.spine.query"><code>EntityQuery</code></a>.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../io/spine/query/EntityQuery.html" title="class in io.spine.query">EntityQuery</a>&lt;I,S extends <a href="../../../io/spine/base/EntityState.html" title="interface in io.spine.base">EntityState</a>&lt;I,?,?&gt;,B extends <a href="../../../io/spine/query/EntityQueryBuilder.html" title="class in io.spine.query">EntityQueryBuilder</a>&lt;I,S,B,?&gt;&gt;</td>
<td class="colLast">
<div class="block">A query for the records being the stored Protobuf messages, each declared
 as a state of an Entity.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../io/spine/query/EntityQueryBuilder.html" title="class in io.spine.query">EntityQueryBuilder</a>&lt;I,S extends <a href="../../../io/spine/base/EntityState.html" title="interface in io.spine.base">EntityState</a>&lt;I,?,?&gt;,B extends <a href="../../../io/spine/query/EntityQueryBuilder.html" title="class in io.spine.query">EntityQueryBuilder</a>&lt;I,S,B,Q&gt;,Q extends <a href="../../../io/spine/query/EntityQuery.html" title="class in io.spine.query">EntityQuery</a>&lt;I,S,B&gt;&gt;</td>
<td class="colLast">
<div class="block">Base type for builders of queries which are aimed to fetch the records of entity states.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../io/spine/query/EntityStateField.html" title="class in io.spine.query">EntityStateField</a></td>
<td class="colLast">
<div class="block">A subscribable field of an <a href="../../../io/spine/base/EntityState.html" title="interface in io.spine.base"><code>entity state</code></a>.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../io/spine/query/IdCriterion.html" title="class in io.spine.query">IdCriterion</a>&lt;I,B extends io.spine.query.AbstractQueryBuilder&lt;I,?,?,B,?&gt;&gt;</td>
<td class="colLast">
<div class="block">An expression which sets the values of record identifiers to be used
 in a <a href="../../../io/spine/query/Query.html" title="interface in io.spine.query">query</a>.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../io/spine/query/IdParameter.html" title="class in io.spine.query">IdParameter</a>&lt;I&gt;</td>
<td class="colLast">
<div class="block">Sets the identifiers of objects which a <a href="../../../io/spine/query/Query.html" title="interface in io.spine.query"><code>Query</code></a> targets.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../io/spine/query/QueryPredicate.html" title="class in io.spine.query">QueryPredicate</a>&lt;R&gt;</td>
<td class="colLast">
<div class="block">Joins the <a href="../../../io/spine/query/SubjectParameter.html" title="class in io.spine.query">query parameters</a> with
 a <a href="../../../io/spine/query/LogicalOperator.html" title="enum in io.spine.query">logical operator</a> when querying the records.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../io/spine/query/RecordColumn.html" title="class in io.spine.query">RecordColumn</a>&lt;R extends com.google.protobuf.Message,V&gt;</td>
<td class="colLast">
<div class="block">A piece of data stored as a column along with some stored record.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../io/spine/query/RecordCriterion.html" title="class in io.spine.query">RecordCriterion</a>&lt;I,R extends com.google.protobuf.Message,V&gt;</td>
<td class="colLast">
<div class="block">Sets a condition for a record column to be compared to some value.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../io/spine/query/RecordQuery.html" title="class in io.spine.query">RecordQuery</a>&lt;I,R extends com.google.protobuf.Message&gt;</td>
<td class="colLast">
<div class="block">A query for the records each being a stored Protobuf message.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../io/spine/query/RecordQueryBuilder.html" title="class in io.spine.query">RecordQueryBuilder</a>&lt;I,R extends com.google.protobuf.Message&gt;</td>
<td class="colLast">
<div class="block">A builder for <a href="../../../io/spine/query/RecordQuery.html" title="class in io.spine.query"><code>RecordQuery</code></a>.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../io/spine/query/RecordSubjectParameter.html" title="class in io.spine.query">RecordSubjectParameter</a>&lt;R extends com.google.protobuf.Message,V&gt;</td>
<td class="colLast">
<div class="block">A parameter of a <a href="../../../io/spine/query/RecordQuery.html" title="class in io.spine.query"><code>RecordQuery</code></a>.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../io/spine/query/SortBy.html" title="class in io.spine.query">SortBy</a>&lt;C extends <a href="../../../io/spine/query/RecordColumn.html" title="class in io.spine.query">RecordColumn</a>&lt;R,?&gt;,R extends com.google.protobuf.Message&gt;</td>
<td class="colLast">
<div class="block">Defines the sorting order of the <a href="../../../io/spine/query/Query.html" title="interface in io.spine.query">query</a> results by the sorting order
 of values in a particular <a href="../../../io/spine/query/RecordColumn.html" title="class in io.spine.query">column</a>.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../io/spine/query/Subject.html" title="class in io.spine.query">Subject</a>&lt;I,R extends com.google.protobuf.Message&gt;</td>
<td class="colLast">
<div class="block">Set of criteria for the records obtained via querying.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../io/spine/query/SubjectParameter.html" title="class in io.spine.query">SubjectParameter</a>&lt;R,C extends <a href="../../../io/spine/query/Column.html" title="interface in io.spine.query">Column</a>&lt;R,V&gt;,V&gt;</td>
<td class="colLast">
<div class="block">A parameter which defines the expected value for the <a href="../../../io/spine/query/RecordColumn.html" title="class in io.spine.query">record column</a>
 in scope of a particular <a href="../../../io/spine/query/Query.html" title="interface in io.spine.query">query</a>.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Enum Summary table, listing enums, and an explanation">
<caption><span>Enum Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Enum</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../io/spine/query/ComparisonOperator.html" title="enum in io.spine.query">ComparisonOperator</a></td>
<td class="colLast">
<div class="block">Defines how the queried records are compared against the desired parameter values.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../io/spine/query/Direction.html" title="enum in io.spine.query">Direction</a></td>
<td class="colLast">
<div class="block">The direction of sorting for the set of records by some field value.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../io/spine/query/LogicalOperator.html" title="enum in io.spine.query">LogicalOperator</a></td>
<td class="colLast">
<div class="block">Logical operators used in querying.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Annotation Types Summary table, listing annotation types, and an explanation">
<caption><span>Annotation Types Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Annotation Type</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../io/spine/query/RecordColumns.html" title="annotation in io.spine.query">RecordColumns</a></td>
<td class="colLast">
<div class="block">Annotates the types which define the columns of the Protobuf messages stored as records
 in a storage.</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package.description">
<!--   -->
</a>
<h2 title="Package io.spine.query Description">Package io.spine.query Description</h2>
<div class="block">This package defines the query DSL for the stored Protobuf messages.

 <h3>Preface</h3>

 <p>A significant part of the Protobuf messages emitted in the Spine-powered applications are
 written and read from a persistent storage at some point in their lifecycle. At the same time,
 Spine apps follow the hexagonal architecture. Instead of writing a database-specific code,
 developers deal with an abstraction over a database port. Under these circumstances,
 a convenient language is required to describe the how the message data is saved and retrieved.

 <p>Proto messages may have complex structure which hardly maps to a flat structure of most
 relational databases and even some NoSQL storages. Therefore, when a Protobuf message
 is persisted, it is typically transformed to a byte array through the native Protobuf
 serialization mechanism. The resulting record is stored along with its identifier.
 It's worth mentioning that the Protobuf binary format makes the records compact in size and
 resilient to any future changes made to the declaration of a stored <code>Message</code>. There
 are more information available on the Protobuf serialization performance
 <a href="https://dzone.com/articles/protobuf-performance-comparison-and-points-to-make">over
 the web</a>.

 <p>While storing a <code>Message</code> as a BLOB simplifies writing, it makes searching and
 filtering of the stored records difficult. Except for IDs, no attributes of persisted messages
 are exposed to the search engine of a DBMS by default. Therefore, the framework allows defining
 additional attributes of a message to enable querying. In terms of storage language,
 each declared attribute is persisted as a "column". Please note that on this level of abstraction
 a developer does not define the structure of an underlying database; it's still a responsibility
 of a particular storage port.

 <p>This package provides an API on building the queries for the stored records, rather than
 configuring the storage port. Other libraries of the framework, such as <code>spine-server</code> and
 <code>spine-datastore</code> concentrate on setting up the underlying database and interacting with it.

 <h3>Record Queries</h3>

 <p>In scope of this document, a "record" means a Protobuf message persisted into a storage.
 Each record has an identifier, a serialized <code>Message</code> content as BLOB, and potentially
 declares one or more record columns. A column is typically a part of a stored message
 (e.g. a field, or a value of a function of several fields) which is stored in the same DB object
 or a table row.

 <p>The stored records may be queried in one of three ways:

 <ul>
     <li>by the value of the record identifiers;</li>

     <li>by the values of the stored columns;</li>

     <li>all records, without any criteria or restrictions.</li>
 </ul>

 <p>Let's think of some example <code>Message</code>:

 <pre>
 // Describes a car manufacturer as a company.
 message Manufacturer {

     ManufacturerId id = 1 [(required) = true, (validate) = true];

     // When the company was founded.
     google.protobuf.Timestamp when_founded = 2 [(required) = true];

     // How many employees work in the company.
     int32 number_of_employees = 3 [(min).value = "1"];

     // The type of the company as a legal entity.
     LegalEntityType type = 4;

     // If traded, which stock symbols the company uses.
     repeated TradeStockSymbol stock_symbol = 5;
 }
 </pre>

 <p>A developer may want to choose a couple of values to be stored as distinct columns:

 <pre>
  public static final class ManufacturerColumns {

    public static final RecordColumn&lt;Manufacturer, Timestamp&gt; whenFounded = 
            new RecordColumn&lt;&gt;("when_founded", 
                               Timestamp.class,
                               Manufacturer::getWhenFounded);

    public static final RecordColumn&lt;Manufacturer, Boolean&gt; isTraded = 
            new RecordColumn&lt;&gt;("is_traded", 
                               Boolean.class,
                               (r) -> !r.getStockSymbolList()
                                        .isEmpty());

    private ManufacturerColumns() {
    }
 }
 </pre>

 <p>In this case, <code>Manufacturer.when_founded</code> field of the message is stored as-is,
 while the <code>is_traded</code> column is declared to contain the value computed from
 the passed <code>r</code>, being the instance of <code>Manufacturer</code> message.

 <p>Once the columns are declared, they may be used in a query. The framework provides
 a <a href="../../../io/spine/query/RecordQueryBuilder.html" title="class in io.spine.query"><code>RecordQueryBuilder</code></a> for this purpose:

 <pre>
     RecordQuery&lt;ManufacturerId, Manufacturer&gt; query = 
        RecordQuery.newBuilder(ManufacturerId.class, Manufacturer.class)
                   .where(whenFounded).isLessOrEqualTo(THURSDAY)
                   .where(isTraded).is(true)
                   .build();
 </pre>

 <p>Where <code>whenFounded</code> and <code>isTraded</code> are the statically imported definitions
 from the <code>ManufacturerColumns</code> class defined above. The types of the values passed to
 the <code>isLessOrEqualTo(..)</code>
 and is(..) methods strictly
 correspond to the types of the declared columns. That is, <code>whenFounded</code> column would
 only accept <code>Timestamp</code> values for comparison, and <code>isTraded</code> only
 accepts <code>Boolean</code>s.

 <p>It is also possible to build a query with a disjunction (OR) operator:

 <pre>
      RecordQuery&lt;ManufacturerId, Manufacturer&gt; query = 
                     manufacturerBuilder()
                             .either((b) -> b.where(whenFounded).isLessThan(firstJanuary1990),
                                     (b) -> b.where(isTraded).is(true))
                             .build();
 </pre>

 <p>Where <code>b</code> is the instance of the same <code>RecordQueryBuilder</code>, for proper chaining.
 This query selects all the records which have either <code>whenFounded</code> value less than
 January, 1, 1990, or the <code>isTraded</code> value equal to <code>true</code>.

 <p>Please note that <code>ManufacturerId</code> is used as a type of the record identifier when
 creating a builder, as it is the first field declared in this message. Its values may
 also be used in a query builder:

 <pre>
     RecordQuery&lt;ManufacturerId, Manufacturer&gt; query = 
        RecordQuery.newBuilder(ManufacturerId.class, Manufacturer.class)
                   .id().is(someManufacturer)
                   .build();
 </pre>

 <p>Where <code>someManufacturer</code> must a value of <code>ManufacturerId</code> type. In addition
 to <a href="../../../io/spine/query/IdCriterion.html#is-I-"><code>is(value)</code></a>, the framework also provides
 <a href="../../../io/spine/query/IdCriterion.html#in-I...-"><code>in(...values)</code></a> and
 <a href="../../../io/spine/query/IdCriterion.html#in-java.lang.Iterable-"><code>in(Iterable values)</code></a>
 overloads. They select the records by several ID values.

 <h4>Sorting and limit</h4>

 <p>The query builder API also allows specifying the sorting order and the record limit
 for the queries:

 <pre>
      RecordQuery&lt;ManufacturerId, Manufacturer&gt; query = 
         RecordQuery.newBuilder(ManufacturerId.class, Manufacturer.class) 
                    .sortAscendingBy(whenFounded)
                    .sortDescendingBy(isTraded)
                    .limit(10)
                    .build();
 </pre>

 <p>This query selects all records of <code>Manufacturer</code> type, but tells to sort them
 by the values of <code>whenFounded</code> column ascending, then by <code>isTraded</code> column values
 descending. Finally, the query result is limited to the top ten records.

 <p>Please note, that limit(..)
 method may only be used in queries which sort their results. Otherwise, a runtime exception
 is thrown upon building the query.

 <h4>Field masks</h4>

 <p>Sometimes end-users are interested in obtaining only a part of the fields of stored messages.
 In this case, they may specify a <code>FieldMask</code> to be applied
 to each of the resulting records. The functionality of the field masks is supported fully,
 as per the <a href="https://developers.google.com/protocol-buffers/docs/reference/java/com/google/protobuf/FieldMask">original contract</a>.

 <p>Let's see it in action:

 <pre>
      FieldMask mask = fieldMaskWith(isTraded);   // Only keep the `is_traded` field in results.
      RecordQuery&lt;ManufacturerId, Manufacturer&gt; query = 
         RecordQuery.newBuilder(ManufacturerId.class, Manufacturer.class) 
                    .withMask(mask)
                    .build();
 </pre>

 <p>The query above selects all records of <code>Manufacturer</code> type, but applies the field
 mask to each of the resulting records. Depending on the implementation of an underlying storage,
 the field mask value may be used to optimize the call to the native storage, and fetch
 only the required values, for instance, if they are stored separately as columns.

 <h3>Entity Queries</h3>

 <p>Among all the stored Protobuf messages, there is a special case. If a message is declared as
 an Entity state, it triggers an additional processing on a build-time. The framework
 automatically extends the Java types generated for Entity states with more Entity-specific API.

 <p>Let's consider a message:

 <pre>
 message ProjectView {
    option (entity).kind = PROJECTION;

    // The identifier of the project.
    ProjectId project = 1;

    ProjectName project_name = 2 [(column) = true];

    Project.Status status = 3 [(column) = true];

    UserView assignee = 4;

    int32 days_since_started = 5 [(column) = true];

    bool was_reassigned = 6 [(column) = true];

    repeated string tag = 7;
 }
 </pre>

 <p>The <code>ProjectView</code> message is declared as a state of a future Projection. As it is
 a part of a Ubiquitous Language, its Protobuf definition serves as a contract for everyone
 wishing to interact with it. In particular, this message marks some of its fields
 with the <code>(column)</code> option. It tells everyone, that the instances of this Projection
 will be available for querying by the values of these fields.

 <p>In terms of the code generation, the framework automatically appends the corresponding
 Java type with the nested <code>Query</code> and <code>QueryBuilder</code> types. They are composed
 at build-time and contain the definitions of the columns for the respective storage record,
 and the query DSL.

 <p>Notice the difference with the <a href="../../../io/spine/query/RecordQueryBuilder.html" title="class in io.spine.query"><code>RecordQueryBuilder</code></a>
 API, as the developer no longer needs to declare any types by hand.

 <p>Here is an example:

 <pre>
     ProjectView.Query query = ProjectView.query()
        .status().isNot(Status.CREATED)
        .daysSinceStarted().isGreaterThan(5)
        .build();
 </pre>

 <p>It produces a query for all the <code>ProjectView</code> records which status is not
 <code>CREATED</code> and which were started more than five days ago.

 <p>Disjunction (or OR statements) are also supported:</p>

 <pre>
     Either&lt;ProjectView.QueryBuilder&gt; startedMoreThanMonthAgo = 
        project -> project.daysSinceStarted().isGreaterThan(30);
     Either&lt;ProjectView.QueryBuilder&gt; isDone =                  
        project -> project.status().is(Status.DONE);

 ProjectView.Query query =
        ProjectView.query()
                   .either(startedMoreThanMonthAgo, isDone)
                   .build();
 </pre>

 <p>This piece produces a query targeting the projects which are either done or started more
 than thirty days ago.

 <p>The first field of the Message is treated as an identifier. It's important to understand that
 Spine treats the field declared first in the order of reading. And not the one with
 the least index value.

 <p>The name of the ID field is preserved and is exposed for querying:

 <pre>
     ProjectView.Query query = ProjectView.query()
                                          .project().is(expectedId)
                                          .build();
 </pre>

 <h4>Custom Columns</h4>

 <p>In addition to the columns declared in the Entity state, the query API allows declaring
 the custom columns. They are intended to handle the cases in which some computed on-the-fly data
 should be stored along with the record. It may the time of entity creation, the role of the
 user created the record, whether the entity is deleted or archived etc. That is, something
 which isn't included into the definition of the original <code>Message</code> type of the record.

 <pre>
 // The column presumably defined as a custom column for querying.
 class ArchivedColumn extends CustomColumn&lt;EntityWithLifecycle, Boolean&gt; {

    @Override 
    public ColumnName name() {
        return ColumnName.of("archived");
    }

    @Override 
    public Class&lt;Boolean&gt; type() {
        return Boolean.class;
    }

    @Override 
    public Boolean valueIn(EntityWithLifecycle source) {
        return source.isArchived();
    }
 }
 </pre>

 <p>Where <code>EntityWithLifecycle</code> is a sample interface serving as a source of the lifecycle
 values for the Entity types.

 <pre>
 // Custom columns that define Entity lifecycle.
 public enum Lifecycle {

    ARCHIVED(new ArchivedColumn()),

    DELETED(new DeletedColumn());

    private final CustomColumn&lt;?, Boolean&gt; column;

    Lifecycle(CustomColumn&lt;?, Boolean&gt; column) {
        this.column = column;
    }

    // Returns the column declaration.
    public CustomColumn&lt;?, Boolean&gt; column() {
        return column;
    }
 }
 </pre>

 <p>Such an approach allows defining the singleton instances of the columns and using
 them in querying:

 <pre>
     ProjectView.Query queryForDeleted =
        ProjectView.query()
                   .where(DELETED.column(), true)
                   .build();
 </pre>

 <h4>Sorting and limit</h4>

 <p>Similar to the plain record query API, it is possible to set the same sorting parameters
 when querying the Entity state records:

 <pre>
     ProjectView.Query query = ProjectView.query()
        .sortAscendingBy(daysSinceStarted())
        .sortAscendingBy(projectName())
        .sortDescendingBy(wasReassigned())
        .limit(10)
        .build();
 </pre>

 <p>Here <code>daysSinceStarted()</code>, <code>projectName()</code> and <code>wasReassigned()</code> are three
 static methods generated in <code>ProjectView.Column</code> class. Each of them returns
 the declaration of the Entity column corresponding to the Message field with
 the <code>(column)</code> option.

 <h4>Field masks</h4>

 <p>It is also possible to set the mask for each resulting Protobuf message:

 <pre>
     FieldMask mask = fieldMaskWith(status());
     ProjectView.Query query = ProjectView.query()
                                          .withMask(mask)
                                          .build();
 </pre>

 <h4>Entity states with no columns</h4>

 <p>If a Proto message declares an Entity state with no columns, the framework still requires
 at least one field declared. As described above, it is treated as an Entity identifier.
 Therefore, both <code>QueryBuilder</code> and <code>Query</code> are generated for this case, allowing
 to query the Entity state records by their identifiers.

 <h3>Further reading</h3>

 <p>To see the Query API in action, please feel free to navigate to the corresponding test
 classes residing in the same package of the <code>test</code> source root.</div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../io/spine/protobuf/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../io/spine/reflect/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?io/spine/query/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
